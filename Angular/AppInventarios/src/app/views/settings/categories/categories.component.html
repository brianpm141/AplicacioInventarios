<div class="view-header">
  <h1>Administra las categorías de equipos y consumibles</h1>
</div>

<div class="form-section">
  <form [formGroup]="categoryForm" (ngSubmit)="submitForm()">
    <div>
      <label for="name">Nombre</label>
      <input id="name" type="text" formControlName="name" placeholder="Nombre" />
    </div>

    <div>
      <label for="description">Descripción</label>
      <input id="description" type="text" formControlName="description" placeholder="Descripción" />
    </div>

    <div>
      <label for="type">Tipo</label>
      <select id="type" formControlName="type">
        <option [value]="0">Equipos</option>
        <option [value]="1">Consumibles</option>
      </select>
    </div>

    <!-- Nueva sección para los campos personalizados -->
    <div *ngIf="customFields.length > 0">
      <div *ngFor="let field of customFields">
        <label [for]="field.name">{{ field.name }}</label>
        <input 
          *ngIf="field.data_type === 'text'" 
          [id]="field.name" 
          [formControlName]="field.name" 
          placeholder="Ingresa {{ field.name }}" 
        />
        <input 
          *ngIf="field.data_type === 'number'" 
          [id]="field.name" 
          [formControlName]="field.name" 
          placeholder="Ingresa {{ field.name }}" 
          type="number"
        />
        <input 
          *ngIf="field.data_type === 'ip'" 
          [id]="field.name" 
          [formControlName]="field.name" 
          placeholder="Ingresa {{ field.name }}" 
        />
      </div>
    </div>

    <div class="form-buttons">
      <button type="submit" [disabled]="categoryForm.invalid">
        {{ isEditing ? 'Actualizar' : 'Crear' }}
      </button>
      <button type="button" class="cancel-btn" *ngIf="isEditing" (click)="resetForm()">Cancelar</button>
    </div>
  </form>
</div>

<div class="table-section">
  <h3>Listado de Categorías</h3>
  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Descripción</th>
        <th>Tipo</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let cat of categories">
        <td>{{ cat.name }}</td>
        <td>{{ cat.description }}</td>
        <td>{{ getTypeLabel(cat.type) }}</td>
        <td class="actions">
          <button (click)="editCategory(cat)">Editar</button>
          <button (click)="confirmDelete(cat.id)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


<div class="message-box success" *ngIf="successMessage">
  <div class="icon">✔️</div>
  {{ successMessage }}
</div>


<div class="message-box error" *ngIf="errorMessage">
  <div class="icon">❌</div>
  {{ errorMessage }}
</div>


<div id="confirm-backdrop" *ngIf="confirmId !== null">
  <div id="confirm-modal">
    <div id="confirm-header">
      Confirmar Eliminación
      <button id="confirm-close-btn" (click)="confirmId = null">&times;</button>
    </div>
    <div id="confirm-body">
      ¿Estás seguro de eliminar esta categoría?
      <div id="confirm-buttons">
        <button class="btn-green" (click)="deleteCategory(confirmId!)">Sí, eliminar</button>
        <button class="btn-yellow" (click)="confirmId = null">Cancelar</button>
      </div>
    </div>
  </div>
</div>
